"use strict";var vm=new Vue({el:"#app",data:{phone:"",orderId:0,goodsInfo:{productName:"",cover:"",brief:"",totalAmount:"",count:""},bottom:!0,showPop:!1,statusTime:"",popTitle:"",popContent:[],setStyle:"",url:"",status:-1,orderStatus:"暂无",statusWords:"暂无",objAddress:"",orderNo:"",createTime:"",id:"",hasSubmit:0},methods:{getOrderDetail:function(){var t=this,o=getApiUrl("/shop-test/rest/orders/dingding/view");$.ajax({type:"get",data:{id:this.orderId},url:o,success:function(o){200==o.code&&(vm.status=o.data.status,9==vm.status?(vm.statusWords="商品租用到期后买断或完成回收，冻结预授权金额将会释放",vm.orderStatus="租用中",vm.bottom=!0):3==vm.status?(vm.statusWords=o.data.expressName+"："+o.data.expressLastInfo.time+" "+o.data.expressLastInfo.status,vm.orderStatus="待收货",vm.bottom=!0):0==vm.status?(vm.statusWords="请尽快完成支付，把宝贝带回家哦",vm.orderStatus="待支付",vm.bottom=!0):10==vm.status?(vm.statusWords="宝贝到期啦，重新下单吧",vm.orderStatus="租期已满",vm.bottom=!0):2==vm.status?(vm.statusWords="订单已经在备货中，请耐心等待",vm.orderStatus="待发货",vm.bottom=!0):16==vm.status?(vm.statusWords="请调整完善审核资料，增加审核成功概率",vm.orderStatus="审核拒绝",vm.bottom=!0):15==vm.status?(vm.statusWords="我们会在两个工作日内完成审核，请耐心等待",vm.orderStatus="审核中",vm.bottom=!0):1==vm.status?(vm.statusWords="订单取消，用户主动取消",vm.orderStatus="订单取消",vm.bottom=!0):(vm.statusWords="订单失效",vm.orderStatus="订单失效",vm.bottom=!0),vm.statusTime=getTime(o.data.createTime,2),vm.phone=o.data.phone.substring(0,3)+"****"+o.data.phone.substring(7),null!=o.data.totalAmount&&0!=o.data.totalAmount||(o.data.totalAmount=0),o.data.totalAmount=o.data.totalAmount.toFixed(2),o.data.nailFreezeDeposit=o.data.nailFreezeDeposit.toFixed(2),o.data.freeDeposit=(o.data.totalAmount-o.data.nailFreezeDeposit).toFixed(2),vm.objAddress=o.data,vm.goodsInfo.productName=o.data.productName,vm.goodsInfo.cover=o.data.cover,vm.goodsInfo.brief=o.data.brief,vm.goodsInfo.totalAmount=o.data.totalAmount,vm.goodsInfo.count=o.data.quantity,vm.orderNo=o.data.sn,vm.createTime=o.data.createTime,"true"==window.localStorage.getItem("tzgPay")&&(t.hasSubmit=1,setTimeout(function(){t.pay()},1e3),window.localStorage.setItem("tzgPay",!1)))},error:function(t){ddToast("网络错误")}})},toBillOrder:function(){location.href="billOrder.html?orderId="+this.orderId},toUserAuth:function(){location.href="userAuth.html"},openModal:function(t){"payTip"==t?(this.popTitle="支付宝免密支付",this.setStyle="",this.popContent=["租用中，相关费用由商户通过支付宝向用户发起扣款，如约归还物品后，支付宝免密支付自动取消"]):"signTip"==t?(this.popTitle="签收须知",this.setStyle="",this.popContent=["收货当天你需求:","1.检查商品外包装完整；","2.快递本人签收；","3.签收当天视为合约生效"]):"contactTip"==t&&(this.popTitle="客服电话",this.setStyle="textAlign:center;fontSize:.38rem;lineHeight:2",this.popContent=['<a href="tel:0571-8518073" style="color:#333">0571-85180735</a>']),this.showPop=!0},retBack:function(){location.href="refunds.html?orderNo="+this.orderNo},toLogistics:function(){location.href="logistics.html?orderNo="+this.orderNo+"&createTime="+this.createTime},pay:function(){var t=this;this.hasSubmit=1;var o=getPhpApiUrl("/nail/immediatelypay.html");$.ajax({url:o,type:"POST",dataType:"json",data:{order_no:this.orderNo,order_id:this.orderId},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(o){200==o.code?1==o.data.flag||2==o.data.flag?(2==o.data.flag&&window.localStorage.setItem("tzgPay",!0),location.href=o.data.html):0==o.data.flag&&t.SecretFree():o.code==-1?t.$dialog.alert({message:"请到支付宝 > 我的 > 账单 </br>里完成支付",confirmButtonText:"我知道了"}).then(function(){}):ddToast(o.message)},error:function(o){t.hasSubmit=0,ddToast("网络错误")}})},SecretFree:function(){var t=this,o=getPhpApiUrl("/nail/nailpay.html");$.ajax({url:o,type:"POST",dataType:"json",data:{order_no:this.orderNo,order_id:this.orderId},xhrFields:{withCredentials:!0},crossDomain:!0,success:function(o){200==o.code?(t.orderId=o.data,location.href="orderSuccess.html?orderId="+t.orderId):o.code==-1&&(location.href="orderFailed.html?productId="+t.order.productId)},error:function(t){ddToast("网络错误")}})}},mounted:function(){this.orderId=getUrlParam("orderId"),this.getOrderDetail(),ddShare(window.location.href)}});